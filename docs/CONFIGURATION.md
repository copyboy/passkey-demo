# ğŸ”§ é…ç½®è¯´æ˜æ–‡æ¡£

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•é…ç½®Passkeyæ¼”ç¤ºåº”ç”¨ä»¥æ”¯æŒä¸åŒçš„ç½‘ç»œè®¿é—®æ¨¡å¼ï¼ŒåŒ…æ‹¬æœ¬åœ°è®¿é—®ã€å±€åŸŸç½‘è®¿é—®å’Œè‡ªå®šä¹‰åŸŸåé…ç½®ã€‚

## ğŸ“‹ é…ç½®æ¦‚è§ˆ

åº”ç”¨ç°åœ¨ä½¿ç”¨ç»Ÿä¸€çš„é…ç½®ç³»ç»Ÿï¼Œæ‰€æœ‰ä¸ç½‘ç»œã€åŸŸåã€IPç›¸å…³çš„è®¾ç½®éƒ½é›†ä¸­åœ¨ `app/src/config/index.ts` æ–‡ä»¶ä¸­ç®¡ç†ã€‚

## ğŸŒ ç½‘ç»œè®¿é—®é…ç½®

### 1. æœ¬åœ°è®¿é—®ï¼ˆé»˜è®¤ï¼‰
é€‚ç”¨äºå•æœºå¼€å‘å’Œæµ‹è¯•ï¼š
```bash
# ä¸éœ€è¦é¢å¤–é…ç½®ï¼Œç›´æ¥è¿è¡Œ
cd app && npm run dev
cd ui && npm run dev

# è®¿é—®åœ°å€
å‰ç«¯: http://localhost:3000
åç«¯: http://localhost:3001
```

### 2. å±€åŸŸç½‘è®¿é—®ï¼ˆå½“å‰é…ç½®ï¼‰
é€‚ç”¨äºåœ¨å…¶ä»–è®¾å¤‡ä¸Šè®¿é—®ï¼Œå¦‚æ‰‹æœºã€å¹³æ¿ç­‰ï¼š

**å½“å‰IPé…ç½®**: `192.168.203.123`

```bash
# è®¿é—®åœ°å€
å‰ç«¯: http://192.168.203.123:3000
åç«¯: http://192.168.203.123:3001
```

### 3. è‡ªå®šä¹‰IPé…ç½®

#### æ–¹æ³•ä¸€ï¼šç¯å¢ƒå˜é‡é…ç½®ï¼ˆæ¨èï¼‰
åˆ›å»º `.env` æ–‡ä»¶ï¼š
```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶
cp env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œä¿®æ”¹IPåœ°å€
HOST_IP=ä½ çš„IPåœ°å€
HOSTNAME=ä½ çš„IPåœ°å€
NEXT_PUBLIC_API_URL=http://ä½ çš„IPåœ°å€:3001/api
```

#### æ–¹æ³•äºŒï¼šç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶
ç¼–è¾‘ `app/src/config/index.ts`ï¼š
```typescript
// ä¿®æ”¹è¿™ä¸€è¡Œ
const getHostIP = (): string => {
  return process.env.HOST_IP || 'ä½ çš„IPåœ°å€';
};
```

ç¼–è¾‘ `ui/src/lib/api.ts`ï¼š
```typescript
// ä¿®æ”¹è¿™ä¸€è¡Œ
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://ä½ çš„IPåœ°å€:3001/api';
```

## ğŸ”§ é…ç½®æ–‡ä»¶è¯¦è§£

### åç«¯é…ç½® (`app/src/config/index.ts`)

```typescript
export const config = {
  // æœåŠ¡å™¨é…ç½®
  server: {
    port: 3001,           // åç«¯ç«¯å£
    host: '0.0.0.0',      // ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£
    hostname: 'IPåœ°å€',    // å¤–éƒ¨è®¿é—®åœ°å€
  },

  // WebAuthn é…ç½®
  webauthn: {
    rpId: 'IPåœ°å€',        // å¿…é¡»ä¸å‰ç«¯è®¿é—®åŸŸååŒ¹é…
    rpName: 'Passkey Demo',
    allowedOrigins: [      // å…è®¸çš„å‰ç«¯è®¿é—®åœ°å€
      'http://localhost:3000',
      'http://IPåœ°å€:3000'
    ],
    timeout: 60000,
  },

  // CORS é…ç½®
  cors: {
    origins: [             // è·¨åŸŸå…è®¸çš„æ¥æº
      'http://localhost:3000',
      'http://IPåœ°å€:3000'
    ],
    credentials: true
  }
}
```

### å‰ç«¯é…ç½® (`ui/src/lib/api.ts`)

```typescript
// APIåŸºç¡€URLé…ç½®
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://IPåœ°å€:3001/api';
```

## ğŸš€ å¿«é€Ÿåˆ‡æ¢é…ç½®

### è·å–å½“å‰IPåœ°å€
```bash
# macOS/Linux
ifconfig | grep -E "inet.*broadcast" | awk '{print $2}' | head -1

# Windows
ipconfig | findstr "IPv4"
```

### å¿«é€Ÿé…ç½®è„šæœ¬
åˆ›å»º `scripts/set-ip.sh`ï¼š
```bash
#!/bin/bash
NEW_IP=$1

if [ -z "$NEW_IP" ]; then
    echo "ç”¨æ³•: ./set-ip.sh <IPåœ°å€>"
    exit 1
fi

# æ›´æ–°ç¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env << EOF
HOST_IP=$NEW_IP
HOSTNAME=$NEW_IP
NEXT_PUBLIC_API_URL=http://$NEW_IP:3001/api
EOF

echo "âœ… IPåœ°å€å·²æ›´æ–°ä¸º: $NEW_IP"
echo "è¯·é‡å¯æœåŠ¡ä»¥åº”ç”¨æ›´æ”¹"
```

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
chmod +x scripts/set-ip.sh
./scripts/set-ip.sh 192.168.1.100
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### WebAuthnåŸŸåé™åˆ¶
- **rpIdå¿…é¡»åŒ¹é…**ï¼šWebAuthnçš„`rpId`å¿…é¡»ä¸ç”¨æˆ·è®¿é—®çš„åŸŸå/IPå®Œå…¨åŒ¹é…
- **HTTPSè¦æ±‚**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPSï¼ˆlocalhosté™¤å¤–ï¼‰
- **è·¨åŸŸé™åˆ¶**ï¼šWebAuthnä¸æ”¯æŒè·¨åŸŸæ“ä½œ

### ç½‘ç»œå®‰å…¨
- ç¡®ä¿é˜²ç«å¢™å…è®¸ç›¸åº”ç«¯å£ï¼ˆ3000, 3001ï¼‰
- å±€åŸŸç½‘è®¿é—®æ—¶æ³¨æ„ç½‘ç»œå®‰å…¨
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨åå‘ä»£ç†å’ŒHTTPS

### æµè§ˆå™¨å…¼å®¹æ€§
ä¸åŒè®¿é—®æ–¹å¼çš„æµè§ˆå™¨æ”¯æŒï¼š
- **localhost**: æ‰€æœ‰ç°ä»£æµè§ˆå™¨æ”¯æŒ
- **IPåœ°å€**: éœ€è¦HTTPSæˆ–ç‰¹æ®Šé…ç½®
- **åŸŸå**: æ¨èæ–¹å¼ï¼Œå®Œæ•´æ”¯æŒ

## ğŸ”„ é…ç½®å˜æ›´æµç¨‹

1. **ä¿®æ”¹é…ç½®æ–‡ä»¶**æˆ–è®¾ç½®ç¯å¢ƒå˜é‡
2. **é‡å¯åç«¯æœåŠ¡**ï¼š`cd app && npm run dev`
3. **é‡å¯å‰ç«¯æœåŠ¡**ï¼š`cd ui && npm run dev`
4. **æ¸…ç†æµè§ˆå™¨ç¼“å­˜**ï¼ˆå¦‚æœéœ€è¦ï¼‰
5. **æµ‹è¯•åŠŸèƒ½**ï¼šæ³¨å†Œâ†’ç™»å½•â†’ç”¨æˆ·ä¿¡æ¯

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šWebAuthnå¤±è´¥
- æ£€æŸ¥rpIdæ˜¯å¦ä¸è®¿é—®åœ°å€åŒ¹é…
- ç¡®è®¤allowedOriginsåŒ…å«å‰ç«¯è®¿é—®åœ°å€
- éªŒè¯CORSé…ç½®æ­£ç¡®

### é—®é¢˜2ï¼šAPIè°ƒç”¨å¤±è´¥
- ç¡®è®¤NEXT_PUBLIC_API_URLé…ç½®æ­£ç¡®
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦åœ¨æ­£ç¡®çš„IPå’Œç«¯å£è¿è¡Œ
- éªŒè¯ç½‘ç»œè¿é€šæ€§

### é—®é¢˜3ï¼šè·¨åŸŸé”™è¯¯
- æ£€æŸ¥CORSé…ç½®æ˜¯å¦åŒ…å«å‰ç«¯åœ°å€
- ç¡®è®¤credentialsè®¾ç½®æ­£ç¡®
- éªŒè¯è¯·æ±‚å¤´é…ç½®

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é…ç½®é—®é¢˜ï¼š
1. æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. éªŒè¯ç½‘ç»œè¿é€šæ€§
3. ç¡®è®¤é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®
4. æŸ¥çœ‹æœåŠ¡å¯åŠ¨æ—¥å¿—
